var ge=t=>{throw TypeError(t)};var Z=(t,e,s)=>e.has(t)||ge("Cannot "+s);var r=(t,e,s)=>(Z(t,e,"read from private field"),s?s.call(t):e.get(t)),m=(t,e,s)=>e.has(t)?ge("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),u=(t,e,s,i)=>(Z(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),p=(t,e,s)=>(Z(t,e,"access private method"),s);import{be as _e,bf as ye,bg as O,bh as ee,bi as G,bj as Fe,bk as te,bl as ve,bm as Ie,bn as Te,bo as De,bp as Re,bq as je,r as S,br as ue,bs as H,j as f,bt as Pe,bu as Le}from"./index-DmrI1hgF.js";import{s as Me,n as Ce,a as ke,u as Oe}from"./index-BrzQTzvJ.js";var C,a,z,R,_,P,U,j,K,L,M,F,I,Q,k,o,N,se,re,ie,ne,ae,oe,ce,Ue,we,qe=(we=class extends _e{constructor(e,s){super();m(this,o);m(this,C);m(this,a);m(this,z);m(this,R);m(this,_);m(this,P);m(this,U);m(this,j);m(this,K);m(this,L);m(this,M);m(this,F);m(this,I);m(this,Q);m(this,k,new Set);this.options=s,u(this,C,e),u(this,j,null),u(this,U,ye()),this.options.experimental_prefetchInRender||r(this,U).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,a).addObserver(this),xe(r(this,a),this.options)?p(this,o,N).call(this):this.updateResult(),p(this,o,ne).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return he(r(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return he(r(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,o,ae).call(this),p(this,o,oe).call(this),r(this,a).removeObserver(this)}setOptions(e,s){const i=this.options,l=r(this,a);if(this.options=r(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof O(this.options.enabled,r(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,o,ce).call(this),r(this,a).setOptions(this.options),i._defaulted&&!ee(this.options,i)&&r(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,a),observer:this});const c=this.hasListeners();c&&Ee(r(this,a),l,this.options,i)&&p(this,o,N).call(this),this.updateResult(s),c&&(r(this,a)!==l||O(this.options.enabled,r(this,a))!==O(i.enabled,r(this,a))||G(this.options.staleTime,r(this,a))!==G(i.staleTime,r(this,a)))&&p(this,o,se).call(this);const n=p(this,o,re).call(this);c&&(r(this,a)!==l||O(this.options.enabled,r(this,a))!==O(i.enabled,r(this,a))||n!==r(this,Q))&&p(this,o,ie).call(this,n)}getOptimisticResult(e){const s=r(this,C).getQueryCache().build(r(this,C),e),i=this.createResult(s,e);return Ae(this,i)&&(u(this,R,i),u(this,P,this.options),u(this,_,r(this,a).state)),i}getCurrentResult(){return r(this,R)}trackResult(e,s){const i={};return Object.keys(e).forEach(l=>{Object.defineProperty(i,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),s==null||s(l),e[l])})}),i}trackProp(e){r(this,k).add(e)}getCurrentQuery(){return r(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,C).defaultQueryOptions(e),i=r(this,C).getQueryCache().build(r(this,C),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return p(this,o,N).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,R)))}createResult(e,s){var me;const i=r(this,a),l=this.options,c=r(this,R),n=r(this,_),y=r(this,P),b=e!==i?e.state:r(this,z),{state:E}=e;let h={...E},q=!1,g;if(s._optimisticResults){const v=this.hasListeners(),T=!v&&xe(e,s),D=v&&Ee(e,i,s,l);(T||D)&&(h={...h,...De(E.data,e.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:$,errorUpdatedAt:A,status:x}=h;if(s.select&&h.data!==void 0)if(c&&h.data===(n==null?void 0:n.data)&&s.select===r(this,K))g=r(this,L);else try{u(this,K,s.select),g=s.select(h.data),g=Re(c==null?void 0:c.data,g,s),u(this,L,g),u(this,j,null)}catch(v){u(this,j,v)}else g=h.data;if(s.placeholderData!==void 0&&g===void 0&&x==="pending"){let v;if(c!=null&&c.isPlaceholderData&&s.placeholderData===(y==null?void 0:y.placeholderData))v=c.data;else if(v=typeof s.placeholderData=="function"?s.placeholderData((me=r(this,M))==null?void 0:me.state.data,r(this,M)):s.placeholderData,s.select&&v!==void 0)try{v=s.select(v),u(this,j,null)}catch(T){u(this,j,T)}v!==void 0&&(x="success",g=Re(c==null?void 0:c.data,v,s),q=!0)}r(this,j)&&($=r(this,j),g=r(this,L),A=Date.now(),x="error");const B=h.fetchStatus==="fetching",X=x==="pending",Y=x==="error",pe=X&&B,be=g!==void 0,w={status:x,fetchStatus:h.fetchStatus,isPending:X,isSuccess:x==="success",isError:Y,isInitialLoading:pe,isLoading:pe,data:g,dataUpdatedAt:h.dataUpdatedAt,error:$,errorUpdatedAt:A,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>b.dataUpdateCount||h.errorUpdateCount>b.errorUpdateCount,isFetching:B,isRefetching:B&&!X,isLoadingError:Y&&!be,isPaused:h.fetchStatus==="paused",isPlaceholderData:q,isRefetchError:Y&&be,isStale:le(e,s),refetch:this.refetch,promise:r(this,U)};if(this.options.experimental_prefetchInRender){const v=W=>{w.status==="error"?W.reject(w.error):w.data!==void 0&&W.resolve(w.data)},T=()=>{const W=u(this,U,w.promise=ye());v(W)},D=r(this,U);switch(D.status){case"pending":e.queryHash===i.queryHash&&v(D);break;case"fulfilled":(w.status==="error"||w.data!==D.value)&&T();break;case"rejected":(w.status!=="error"||w.error!==D.reason)&&T();break}}return w}updateResult(e){const s=r(this,R),i=this.createResult(r(this,a),this.options);if(u(this,_,r(this,a).state),u(this,P,this.options),r(this,_).data!==void 0&&u(this,M,r(this,a)),ee(i,s))return;u(this,R,i);const l={},c=()=>{if(!s)return!0;const{notifyOnChangeProps:n}=this.options,y=typeof n=="function"?n():n;if(y==="all"||!y&&!r(this,k).size)return!0;const d=new Set(y??r(this,k));return this.options.throwOnError&&d.add("error"),Object.keys(r(this,R)).some(b=>{const E=b;return r(this,R)[E]!==s[E]&&d.has(E)})};(e==null?void 0:e.listeners)!==!1&&c()&&(l.listeners=!0),p(this,o,Ue).call(this,{...l,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,o,ne).call(this)}},C=new WeakMap,a=new WeakMap,z=new WeakMap,R=new WeakMap,_=new WeakMap,P=new WeakMap,U=new WeakMap,j=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,F=new WeakMap,I=new WeakMap,Q=new WeakMap,k=new WeakMap,o=new WeakSet,N=function(e){p(this,o,ce).call(this);let s=r(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Fe)),s},se=function(){p(this,o,ae).call(this);const e=G(this.options.staleTime,r(this,a));if(te||r(this,R).isStale||!ve(e))return;const i=Ie(r(this,R).dataUpdatedAt,e)+1;u(this,F,setTimeout(()=>{r(this,R).isStale||this.updateResult()},i))},re=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,a)):this.options.refetchInterval)??!1},ie=function(e){p(this,o,oe).call(this),u(this,Q,e),!(te||O(this.options.enabled,r(this,a))===!1||!ve(r(this,Q))||r(this,Q)===0)&&u(this,I,setInterval(()=>{(this.options.refetchIntervalInBackground||Te.isFocused())&&p(this,o,N).call(this)},r(this,Q)))},ne=function(){p(this,o,se).call(this),p(this,o,ie).call(this,p(this,o,re).call(this))},ae=function(){r(this,F)&&(clearTimeout(r(this,F)),u(this,F,void 0))},oe=function(){r(this,I)&&(clearInterval(r(this,I)),u(this,I,void 0))},ce=function(){const e=r(this,C).getQueryCache().build(r(this,C),this.options);if(e===r(this,a))return;const s=r(this,a);u(this,a,e),u(this,z,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ue=function(e){je.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,R))}),r(this,C).getQueryCache().notify({query:r(this,a),type:"observerResultsUpdated"})})},we);function $e(t,e){return O(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function xe(t,e){return $e(t,e)||t.state.data!==void 0&&he(t,e,e.refetchOnMount)}function he(t,e,s){if(O(e.enabled,t)!==!1){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&le(t,e)}return!1}function Ee(t,e,s,i){return(t!==e||O(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&le(t,s)}function le(t,e){return O(e.enabled,t)!==!1&&t.isStaleByTime(G(e.staleTime,t))}function Ae(t,e){return!ee(t.getCurrentResult(),e)}var Qe=S.createContext(!1),Be=()=>S.useContext(Qe);Qe.Provider;function He(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ne=S.createContext(He()),ze=()=>S.useContext(Ne),Ke=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ve=t=>{S.useEffect(()=>{t.clearReset()},[t])},We=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:l})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(l&&t.data===void 0||Me(s,[t.error,i])),Ge=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Je=(t,e)=>t.isLoading&&t.isFetching&&!e,Xe=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Se=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function Ye(t,e,s){var h,q,g,$,A;const i=ue(),l=Be(),c=ze(),n=i.defaultQueryOptions(t);(q=(h=i.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||q.call(h,n),n._optimisticResults=l?"isRestoring":"optimistic",Ge(n),Ke(n,c),Ve(c);const y=!i.getQueryCache().get(n.queryHash),[d]=S.useState(()=>new e(i,n)),b=d.getOptimisticResult(n),E=!l&&t.subscribed!==!1;if(S.useSyncExternalStore(S.useCallback(x=>{const B=E?d.subscribe(je.batchCalls(x)):Ce;return d.updateResult(),B},[d,E]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),S.useEffect(()=>{d.setOptions(n,{listeners:!1})},[n,d]),Xe(n,b))throw Se(n,d,c);if(We({result:b,errorResetBoundary:c,throwOnError:n.throwOnError,query:i.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw b.error;if(($=(g=i.getDefaultOptions().queries)==null?void 0:g._experimental_afterQuery)==null||$.call(g,n,b),n.experimental_prefetchInRender&&!te&&Je(b,l)){const x=y?Se(n,d,c):(A=i.getQueryCache().get(n.queryHash))==null?void 0:A.promise;x==null||x.catch(Ce).finally(()=>{d.updateResult()})}return n.notifyOnChangeProps?b:d.trackResult(b)}function Ze(t,e){return Ye(t,qe)}const V=ke.create({});V.interceptors.response.use(t=>t,t=>{if(t.response){const{data:e,status:s}=t.response;if(s===401&&H.error("Error: Unauthorized"),e.error||e.errorDescription)H.error(`Error: ${(e==null?void 0:e.error)||(e==null?void 0:e.errorDescription)}`);else{const{message:i}=e;H.error(i||`Error: ${t.message}`)}}else t.message?H.error(`Error: ${t.message}`):t.code&&H.error(`Error: ${t.code}`);return Promise.reject(t)});function J(){const t=localStorage.getItem("token");return{headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}},withCredentials:!0}}async function et(t){try{return(await V.get(t,J())).data}catch(e){throw console.error("Failed to Get:",e),e}}async function tt(t,e,s={}){try{return(await V.post(t,e,{...J(),...s})).data}catch(i){throw console.error("Failed to Create:",i),i}}async function st(t,e,s={}){try{return(await V.put(t,e,{...J(),...s})).data}catch(i){throw console.error("Failed to Update:",i),i}}async function rt(t,e={}){try{return(await V.delete(t,{...J(),...e})).data}catch(s){throw console.error("Failed to Delete:",s),s}}const de={getResource:et,postResource:tt,putResource:st,deleteResource:rt},fe="http://18.191.69.128:8000/api/",it=()=>Ze({queryKey:["users"],queryFn:async()=>(await de.getResource(`${fe}v1/user/`)).data}),nt=()=>{const t=ue();return Oe({mutationFn:e=>de.postResource(`${fe}v1/users`,e),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})}})},at=()=>{const t=ue();return Oe({mutationFn:e=>de.deleteResource(`${fe}v1/users/${e}`),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})}})},ot=()=>{const{data:t,error:e,isLoading:s,refetch:i}=it(),{mutate:l,isPending:c,isError:n,error:y}=at();return s?f.jsx("div",{children:"Loading..."}):e?f.jsxs("div",{children:["Error: ",e.message,f.jsx("button",{onClick:()=>i(),children:"Retry"})]}):f.jsxs("div",{children:[f.jsx("h2",{children:"User List"}),!t||t.length===0?f.jsx("p",{children:"No users available. Add some users using the form above."}):f.jsx("ul",{children:t==null?void 0:t.map(d=>f.jsxs("li",{children:[d.username," (",d.email,")",f.jsx("button",{onClick:()=>l(d.id),disabled:c,children:c?"Deleting...":"Delete"}),n&&f.jsxs("div",{style:{color:"red"},children:["Error: ",y==null?void 0:y.message]})]},d.id))}),f.jsx("button",{onClick:()=>i(),disabled:s,children:s?"Fetching...":"Refresh Users"})]})},ct=()=>{const[t,e]=S.useState(""),[s,i]=S.useState(""),{mutate:l,isPending:c,error:n,isSuccess:y}=nt(),d=b=>{b.preventDefault(),l({username:t,email:s,password:"",last_login:null,is_superuser:!1,is_staff:!1,is_active:!1,date_joined:"",first_name:"",last_name:"",phone_number:"",role:"",org_unit:"",active:!1,created_by:"",created_date:"",modify_by:null,modify_date:null,fk_org_unit_level:null,groups:[],user_permissions:[]},{onSuccess:()=>{e(""),i("")},onError:E=>{console.error("Create user failed:",E)}})};return f.jsxs("form",{onSubmit:d,children:[f.jsx("h2",{children:"Create User"}),f.jsx("input",{type:"text",value:t,onChange:b=>e(b.target.value),placeholder:"Name",required:!0}),f.jsx("input",{type:"email",value:s,onChange:b=>i(b.target.value),placeholder:"Email",required:!0}),f.jsx("button",{type:"submit",disabled:c,children:c?"Creating...":"Create User"}),y&&f.jsx("div",{style:{color:"green"},children:"User creation Succesful!"}),n&&f.jsxs("div",{style:{color:"red"},children:["Error: ",n.message]})]})},ht=new Le,pt=()=>f.jsxs(Pe,{client:ht,children:[f.jsx(ct,{}),f.jsx(ot,{})]});export{pt as default};
